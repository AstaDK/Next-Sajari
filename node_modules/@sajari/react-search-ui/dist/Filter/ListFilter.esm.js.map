{"version":3,"file":"ListFilter.esm.js","sources":["../../src/Filter/ListFilter.tsx"],"sourcesContent":["import { Box as CoreBox, Button, Checkbox, CheckboxGroup, Combobox, Radio, RadioGroup } from '@sajari/react-components';\nimport { useFilter, useQuery } from '@sajari/react-hooks';\nimport { getStylesObject, isBoolean, isEmpty, isSSR, noop, useTheme } from '@sajari/react-sdk-utils';\nimport * as React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport tw from 'twin.macro';\n\nimport { IconSmallChevronDown, IconSmallChevronUp } from '../assets/icons';\nimport { useSearchUIContext } from '../ContextProvider';\nimport Box from './Box';\nimport { ListFilterProps } from './types';\nimport { formatLabel, getHeaderId, pinItems } from './utils';\n\nconst ListFilter = (props: Omit<ListFilterProps, 'type'>) => {\n  const {\n    name,\n    title,\n    limit = 10,\n    sort = 'count',\n    sortAscending = sort !== 'count',\n    itemRender,\n    placeholder = '',\n    format,\n  } = props;\n\n  const filterContainerId = `list-${name}`;\n  const { options, reset, setSelected, selected, multi } = useFilter(name, { sort, sortAscending });\n  // Enable search by default if there's more than the limit\n  const { searchable = options.length > limit } = props;\n  // By default, pin selected items if the option count is over limit\n  let { pinSelected } = props;\n  if (!isBoolean(pinSelected)) {\n    pinSelected = options.length > limit;\n  }\n\n  // Because as the selected list changes the elements are being recreated so the focus is not focusing the correct element anymore\n  const [lastFocusedControl, setLastFocusedControl] = React.useState('');\n  const [query, setQuery] = React.useState('');\n  const { query: q } = useQuery();\n  const [shown, setShown] = React.useState(limit);\n  const { disableDefaultStyles = false, customClassNames, currency, language } = useSearchUIContext();\n  const theme = useTheme();\n  const { t } = useTranslation('filter');\n\n  const styles = getStylesObject(\n    {\n      innerList: [tw`flex items-center justify-between`],\n      count: [tw`ml-2 text-xs text-gray-400`],\n      checkbox: [tw`text-sm`],\n      searchWrapper: [tw`mb-2`],\n      toggleButtonWrapper: [tw`mt-1`],\n      toggleIcon: [tw`ml-2`, `color: ${theme.color.primary.base}`],\n    },\n    disableDefaultStyles,\n  );\n\n  // Reset internal query on global query change\n  React.useEffect(() => {\n    setQuery('');\n  }, [q]);\n\n  // Reset shown number when filtering via internal or external query change\n  React.useEffect(() => {\n    setShown(limit);\n  }, [query, q]);\n\n  // On user interaction, get the last element being interacted with BEFORE the list is rerendered and focus that element\n  React.useEffect(() => {\n    if (!isSSR() && pinSelected) {\n      const input = document\n        .querySelector(`#${filterContainerId}`)\n        ?.querySelector(`input[value=\"${lastFocusedControl}\"]`) as HTMLInputElement | null;\n\n      input?.focus();\n    }\n  }, [JSON.stringify(selected)]);\n\n  const Control = multi ? Checkbox : Radio;\n  const filtered = searchable ? options.filter((o) => o.label.toLowerCase().includes(query.toLowerCase())) : options;\n  const slice = filtered.length > limit;\n\n  const transformedItems = React.useMemo(() => {\n    if (!isSSR() && pinSelected) {\n      setLastFocusedControl(`${(document.activeElement as HTMLInputElement).value}`);\n    }\n    let list = filtered;\n\n    if (pinSelected) {\n      list = pinItems(list, selected, 'label');\n    }\n\n    return list;\n  }, [JSON.stringify(filtered), JSON.stringify(selected), pinSelected]);\n\n  const items = slice ? transformedItems.slice(0, shown) : transformedItems;\n  const allShown = shown >= filtered.length;\n  const Icon = allShown ? IconSmallChevronUp : IconSmallChevronDown;\n  const showMore = React.useCallback(() => {\n    if (allShown) {\n      setShown(limit);\n    } else {\n      setShown((s) => s + 20);\n    }\n  }, [allShown]);\n\n  const innerList = React.useMemo(\n    () =>\n      items.map(({ label, count }) => (\n        <CoreBox css={styles.innerList} key={`${label}-${count}`}>\n          <Control\n            value={label}\n            checked={selected.includes(label)}\n            onChange={noop}\n            css={styles.checkbox}\n            disableDefaultStyles={disableDefaultStyles}\n          >\n            {typeof itemRender === 'function' ? itemRender(label) : formatLabel(label, { format, currency, t })}\n          </Control>\n          <span css={styles.count}>{count.toLocaleString(language)}</span>\n        </CoreBox>\n      )),\n    [JSON.stringify(items), itemRender, selected],\n  );\n\n  const filterSearchOnChange = React.useCallback((value) => {\n    setQuery(value || '');\n  }, []);\n\n  if (isEmpty(options) && isEmpty(selected)) {\n    return null;\n  }\n\n  return (\n    <Box title={title} name={name} showReset={selected.length > 0 && multi} onReset={reset}>\n      {searchable ? (\n        <CoreBox css={styles.searchWrapper}>\n          <Combobox\n            value={query}\n            size=\"sm\"\n            className={customClassNames.filter?.list?.searchFilter}\n            placeholder={placeholder}\n            onChange={filterSearchOnChange}\n            disableDefaultStyles={disableDefaultStyles}\n          />\n        </CoreBox>\n      ) : null}\n\n      <CoreBox id={filterContainerId} className={customClassNames.filter?.list?.container}>\n        {multi ? (\n          <CheckboxGroup\n            value={selected}\n            onChange={setSelected}\n            className={customClassNames.filter?.list?.checkboxGroup}\n            disableDefaultStyles={disableDefaultStyles}\n            aria-labelledby={getHeaderId(name)}\n          >\n            {innerList}\n          </CheckboxGroup>\n        ) : (\n          <RadioGroup\n            value={selected[0]}\n            onChange={(e) => setSelected([e.target.value])}\n            className={customClassNames.filter?.list?.radioGroup}\n            disableDefaultStyles={disableDefaultStyles}\n            aria-labelledby={getHeaderId(name)}\n          >\n            {innerList}\n          </RadioGroup>\n        )}\n      </CoreBox>\n\n      {slice ? (\n        <CoreBox css={styles.toggleButtonWrapper}>\n          <Button\n            appearance=\"link\"\n            onClick={showMore}\n            aria-controls={filterContainerId}\n            size=\"sm\"\n            spacing=\"none\"\n            className={customClassNames.filter?.list?.toggleButton}\n            disableDefaultStyles={disableDefaultStyles}\n          >\n            {t(allShown ? 'showLess' : 'showMore')}\n            <Icon css={styles.toggleIcon} />\n          </Button>\n        </CoreBox>\n      ) : null}\n    </Box>\n  );\n};\n\nexport default ListFilter;\nexport type { ListFilterProps };\n"],"names":["ListFilter","props","name","title","limit","sort","sortAscending","itemRender","placeholder","format","filterContainerId","useFilter","options","reset","setSelected","selected","multi","searchable","length","pinSelected","isBoolean","React","lastFocusedControl","setLastFocusedControl","query","setQuery","useQuery","q","shown","setShown","useSearchUIContext","disableDefaultStyles","customClassNames","currency","language","theme","useTheme","useTranslation","t","styles","getStylesObject","innerList","count","checkbox","searchWrapper","toggleButtonWrapper","toggleIcon","color","primary","base","isSSR","input","document","querySelector","focus","JSON","stringify","Control","Checkbox","Radio","filtered","filter","o","label","toLowerCase","includes","slice","transformedItems","activeElement","value","list","pinItems","items","allShown","Icon","IconSmallChevronUp","IconSmallChevronDown","showMore","s","map","_jsxs","CoreBox","_jsx","noop","formatLabel","toLocaleString","filterSearchOnChange","isEmpty","Box","searchFilter","container","checkboxGroup","getHeaderId","e","target","radioGroup","toggleButton"],"mappings":"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"}