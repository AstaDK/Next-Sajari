{"version":3,"file":"index.esm.js","sources":["../../src/Combobox/index.tsx"],"sourcesContent":["/* eslint-disable prefer-arrow-callback */\n\nimport { mergeProps, useId } from '@react-aria/utils';\nimport { __DEV__, getStylesObject, isFunction, isSSR } from '@sajari/react-sdk-utils';\nimport { useCombobox } from 'downshift';\nimport React, { ChangeEvent, KeyboardEvent, useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport tw from 'twin.macro';\n\nimport { IconSearch, IconSmallSearch, IconSpinner } from '../assets/icons';\nimport Box from '../Box';\nimport { useVoiceInput } from '../hooks';\nimport Dropdown from './components/Dropdown';\nimport Typeahead from './components/Typeahead';\nimport Voice from './components/Voice';\nimport ComboboxContextProvider from './context';\nimport { useComboboxStyles } from './styles';\nimport { ComboboxProps, ResultItem } from './types';\n\nconst Combobox = React.forwardRef(function ComboboxInner<T>(props: ComboboxProps<T>, ref: React.Ref<HTMLInputElement>) {\n  const {\n    mode = 'standard',\n    label,\n    placeholder = 'Search',\n    enterKeyHint = 'search',\n    id = `combobox-${useId()}`,\n    invalid,\n    onChange = () => {},\n    onKeyDown = () => {},\n    onVoiceInput = () => {},\n    enableVoice = false,\n    captureVoiceInput = true,\n    loading = false,\n    value: valueProp = '',\n    items = [],\n    completion = '',\n    size = 'md',\n    showDropdownTips = false,\n    showPoweredBy = true,\n    itemToString = mode === 'results'\n      ? (item: T) => ((item as unknown) as ResultItem).title\n      : (item: T) => (item as unknown) as string,\n    itemToUrl = (item: T) => ((item as unknown) as ResultItem).url as string,\n    renderItem,\n    onSelect,\n    disableDefaultStyles = false,\n    className,\n    styles: stylesProp,\n    inputClassName,\n    inputContainerClassName,\n    inputElement,\n    ...rest\n  } = props;\n  const [typedInputValue, setTypedInputValue] = useState(valueProp.toString());\n  const { supported: voiceSupported } = useVoiceInput();\n  const [value, setValue] = useState(valueProp.toString());\n  const [container, setContainer] = useState<undefined | null | Element>();\n\n  useEffect(() => {\n    setValue(valueProp.toString());\n  }, [valueProp]);\n\n  const {\n    isOpen: open,\n    getLabelProps,\n    getMenuProps,\n    getItemProps,\n    getInputProps,\n    getComboboxProps,\n    selectedItem,\n    highlightedIndex,\n    inputValue,\n    setInputValue,\n    closeMenu,\n  } = useCombobox<T>({\n    items,\n    itemToString,\n    inputValue: value,\n    onInputValueChange: (changes) => {\n      setValue(changes.inputValue ?? '');\n    },\n    stateReducer: (state, { changes, type }) => {\n      if (mode === 'suggestions') {\n        switch (type) {\n          case useCombobox.stateChangeTypes.InputKeyDownArrowDown:\n            if (state.highlightedIndex === (items || []).length - 1) {\n              return {\n                ...changes,\n                inputValue: typedInputValue,\n                highlightedIndex: undefined,\n              };\n            }\n\n            if (changes.highlightedIndex !== undefined) {\n              const item = (items || [])[changes.highlightedIndex];\n              const stringItem = itemToString(item);\n\n              if (typeof stringItem !== 'string') {\n                return changes;\n              }\n\n              return {\n                ...changes,\n                inputValue: stringItem,\n                selectedItem: item,\n              };\n            }\n\n            return changes;\n\n          case useCombobox.stateChangeTypes.InputKeyDownArrowUp:\n            if (state.highlightedIndex === 0) {\n              return {\n                ...changes,\n                inputValue: typedInputValue,\n                highlightedIndex: undefined,\n              };\n            }\n\n            if (changes.highlightedIndex !== undefined) {\n              const item = (items || [])[changes.highlightedIndex];\n              const stringItem = itemToString(item);\n\n              if (typeof stringItem !== 'string') {\n                return changes;\n              }\n\n              return {\n                ...changes,\n                inputValue: stringItem,\n                selectedItem: item,\n              };\n            }\n\n            return changes;\n\n          case useCombobox.stateChangeTypes.ItemMouseMove:\n            if (changes.highlightedIndex !== undefined) {\n              const item = (items || [])[changes.highlightedIndex];\n              const stringItem = itemToString(item);\n\n              if (typeof stringItem !== 'string') {\n                return changes;\n              }\n\n              return {\n                ...changes,\n                inputValue: stringItem,\n                selectedItem: item,\n              };\n            }\n            return changes;\n\n          case useCombobox.stateChangeTypes.InputKeyDownEscape:\n            if (state.isOpen) {\n              return {\n                ...changes,\n                isOpen: true,\n                inputValue: typedInputValue,\n              };\n            }\n            return changes;\n\n          case useCombobox.stateChangeTypes.InputKeyDownEnter:\n            return {\n              ...changes,\n              isOpen: false,\n            };\n\n          default:\n            return changes;\n        }\n      }\n\n      if (mode === 'results') {\n        switch (type) {\n          case useCombobox.stateChangeTypes.InputKeyDownEnter:\n            return {\n              ...changes,\n              inputValue: '',\n            };\n\n          case useCombobox.stateChangeTypes.ItemClick:\n            return {\n              ...changes,\n              inputValue: '',\n            };\n\n          case useCombobox.stateChangeTypes.InputChange:\n            if (changes.inputValue === '') {\n              return {\n                ...changes,\n                isOpen: false,\n              };\n            }\n            return changes;\n\n          default:\n            return changes;\n        }\n      }\n\n      return changes;\n    },\n  });\n\n  const context = {\n    mode,\n    inputValue,\n    open,\n    items,\n    completion,\n    selectedItem,\n    highlightedIndex,\n    getMenuProps,\n    getItemProps,\n    showDropdownTips,\n    showPoweredBy,\n    typedInputValue,\n    renderItem,\n    onSelect,\n    itemToString,\n    itemToUrl,\n    disableDefaultStyles,\n    customClassNames: rest,\n  };\n\n  const handleVoiceInput = (input: string) => {\n    if (captureVoiceInput) {\n      setInputValue(input);\n      setTypedInputValue(input);\n    }\n    onVoiceInput(input);\n  };\n\n  const { styles: comboboxStyles, focusProps } = useComboboxStyles({\n    size,\n    voiceEnabled: enableVoice && voiceSupported,\n    loading,\n  });\n\n  const styles = getStylesObject(comboboxStyles, disableDefaultStyles);\n\n  const inputProps = getInputProps({\n    id,\n    className: inputClassName,\n    type: 'search',\n    dir: 'auto',\n    placeholder,\n    'aria-invalid': invalid,\n    autoCapitalize: 'off',\n    autoComplete: 'off',\n    autoCorrect: 'off',\n    spellCheck: 'false',\n    inputMode: 'search',\n    onKeyDown: (e: KeyboardEvent<HTMLInputElement>) => {\n      // Don't supress native form submission when 'Enter' key is pressed\n      // Only if the user isn't focused on an item in the suggestions\n      if (e.key === 'Enter' && highlightedIndex === -1) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (e.nativeEvent as any).preventDownshiftDefault = true;\n\n        if (mode === 'suggestions') {\n          closeMenu();\n        }\n      }\n\n      if (mode !== 'results' && e.key === 'Enter' && highlightedIndex > -1) {\n        setTypedInputValue(itemToString(items[highlightedIndex]));\n      }\n\n      if (mode === 'typeahead' && e.key === 'ArrowRight') {\n        if ((e.target as HTMLInputElement).selectionStart === inputValue.length) {\n          if (completion.startsWith(inputValue)) {\n            setInputValue(completion);\n            setTypedInputValue(completion);\n          }\n        }\n      }\n\n      if (e.key === 'Enter' && highlightedIndex > -1) {\n        const item = (items || [])[highlightedIndex];\n        if (mode === 'results' && itemToUrl && !renderItem) {\n          const url = itemToUrl(item);\n\n          if (url) {\n            window.location.href = url;\n          }\n\n          const result = (item as unknown) as ResultItem;\n          if (isFunction(result.onClick)) {\n            result.onClick();\n          }\n        }\n        if (onSelect) {\n          onSelect(item);\n        }\n      }\n\n      onKeyDown(e);\n    },\n    onInput: (e: ChangeEvent<HTMLInputElement>) => {\n      onChange(e.target.value);\n      setTypedInputValue(e.target.value);\n    },\n    onChange: (e: ChangeEvent<HTMLInputElement>) => {\n      setValue(e.target.value);\n    },\n  });\n\n  const renderInAttachMode = (input: HTMLInputElement) => {\n    if (isSSR()) {\n      return null;\n    }\n    if (container && input) {\n      const InputComponent = React.createElement('input', {\n        ...inputProps,\n        ...Array.from(input.attributes).reduce((acc, attr) => ({ ...acc, [attr.nodeName]: attr.nodeValue }), {}),\n      });\n      const ContainerComponent = React.createElement(\n        'div',\n        {\n          ...getComboboxProps(),\n          style: {\n            position: 'relative',\n          },\n        },\n        [InputComponent, <Dropdown />],\n      );\n      input.remove();\n      return ReactDOM.createPortal(ContainerComponent, container as Element);\n    }\n    return null;\n  };\n\n  useEffect(() => {\n    if (inputElement?.current) {\n      setContainer(inputElement.current.parentElement);\n    }\n  }, [inputElement]);\n\n  return (\n    <ComboboxContextProvider value={context}>\n      {inputElement?.current ? (\n        renderInAttachMode(inputElement.current)\n      ) : (\n        <Box css={[styles.container, stylesProp]} className={className}>\n          <Box css={styles.inputContainer} {...getComboboxProps()}>\n            <Box as=\"label\" css={tw`sr-only`} {...getLabelProps({ htmlFor: id })}>\n              {label ?? placeholder}\n            </Box>\n\n            <Box css={styles.iconContainerLeft} className={inputContainerClassName}>\n              {size === 'sm' ? <IconSmallSearch /> : <IconSearch />}\n            </Box>\n\n            <Typeahead />\n\n            <Box\n              ref={ref}\n              as=\"input\"\n              css={styles.input}\n              {...mergeProps(inputProps, focusProps)}\n              enterKeyHint={enterKeyHint}\n              {...rest}\n            />\n\n            {enableVoice || loading ? (\n              <Box css={styles.iconContainerRight}>\n                {loading && <IconSpinner css={styles.iconSpinner} />}\n                {enableVoice && <Voice onVoiceInput={handleVoiceInput} />}\n              </Box>\n            ) : null}\n          </Box>\n\n          <Dropdown />\n        </Box>\n      )}\n    </ComboboxContextProvider>\n  );\n});\n\nif (__DEV__) {\n  Combobox.displayName = 'Combobox';\n}\n\nexport default Combobox;\nexport type { ComboboxProps };\n"],"names":["Combobox","React","forwardRef","ComboboxInner","props","ref","mode","label","placeholder","enterKeyHint","id","useId","invalid","onChange","onKeyDown","onVoiceInput","enableVoice","captureVoiceInput","loading","value","valueProp","items","completion","size","showDropdownTips","showPoweredBy","itemToString","item","title","itemToUrl","url","renderItem","onSelect","disableDefaultStyles","className","stylesProp","styles","inputClassName","inputContainerClassName","inputElement","rest","useState","toString","typedInputValue","setTypedInputValue","useVoiceInput","voiceSupported","supported","setValue","container","setContainer","useEffect","useCombobox","inputValue","onInputValueChange","changes","stateReducer","state","type","stateChangeTypes","InputKeyDownArrowDown","highlightedIndex","length","undefined","stringItem","selectedItem","InputKeyDownArrowUp","ItemMouseMove","InputKeyDownEscape","isOpen","InputKeyDownEnter","ItemClick","InputChange","open","getLabelProps","getMenuProps","getItemProps","getInputProps","getComboboxProps","setInputValue","closeMenu","context","customClassNames","handleVoiceInput","input","useComboboxStyles","voiceEnabled","comboboxStyles","focusProps","getStylesObject","inputProps","dir","autoCapitalize","autoComplete","autoCorrect","spellCheck","inputMode","e","key","nativeEvent","preventDownshiftDefault","target","selectionStart","startsWith","window","location","href","result","isFunction","onClick","onInput","renderInAttachMode","isSSR","InputComponent","createElement","Array","from","attributes","reduce","acc","attr","nodeName","nodeValue","ContainerComponent","style","position","_jsx","remove","ReactDOM","createPortal","current","parentElement","_jsxs","inputContainer","htmlFor","iconContainerLeft","mergeProps","iconContainerRight","iconSpinner","__DEV__","displayName"],"mappings":"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"}