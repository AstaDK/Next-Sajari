{"version":3,"file":"index.esm.js","sources":["../../src/Select/index.tsx"],"sourcesContent":["import { useId } from '@react-aria/utils';\nimport { __DEV__, cleanChildren, getStylesObject, isArray, isString } from '@sajari/react-sdk-utils';\nimport { useSelect, UseSelectState, UseSelectStateChangeOptions } from 'downshift';\nimport * as React from 'react';\n\nimport Box from '../Box';\nimport Label from '../Label';\nimport Button from './components/Button';\nimport Dropdown from './components/Dropdown';\nimport { OptionProps } from './components/Option';\nimport SelectContextProvider from './context';\nimport { useSelectStyles } from './styles';\nimport { Item, SelectProps } from './types';\n\nconst Select = React.forwardRef((props: SelectProps, ref?: React.Ref<HTMLDivElement>) => {\n  const {\n    id = `select-${useId()}`,\n    children,\n    label,\n    name,\n    value,\n    onChange,\n    size = 'md',\n    disabled = false,\n    invalid = false,\n    multiple = false,\n    autofocus = false,\n    text,\n    disableDefaultStyles = false,\n    styles: stylesProp,\n    className,\n    buttonClassName,\n    dropdownClassName,\n    optionClassName,\n  } = props;\n\n  const { styles: selectStyles } = useSelectStyles();\n  const styles = getStylesObject(selectStyles, disableDefaultStyles);\n\n  const stateReducer = (state: UseSelectState<Item>, actionAndChanges: UseSelectStateChangeOptions<Item>) => {\n    const { changes, type } = actionAndChanges;\n\n    switch (type) {\n      case useSelect.stateChangeTypes.MenuKeyDownEnter:\n      case useSelect.stateChangeTypes.MenuKeyDownSpaceButton:\n      case useSelect.stateChangeTypes.ItemClick:\n        return {\n          ...changes,\n          isOpen: multiple, // Keep menu open after selection for multiple\n          highlightedIndex: state.highlightedIndex,\n        };\n\n      default:\n        return changes;\n    }\n  };\n\n  const itemToString = (item: Item): string => item?.value?.toString() ?? '';\n\n  // Build items list from children\n  const items: Array<Item> = React.useMemo(\n    () =>\n      cleanChildren(children).reduce(\n        (out, { props: optionProps }: { props: OptionProps }) => [...out, optionProps],\n        [] as Array<Item>,\n      ),\n    [children],\n  );\n\n  const mapValues = (input?: SelectProps['value']) => {\n    if (typeof input === 'undefined') {\n      return [];\n    }\n\n    // Determine initial values\n    const values = isArray(input) ? input.map(String) : [input.toString()];\n\n    return multiple ? values : values.slice(0, 1);\n  };\n\n  // If no `value` prop is set, get selected props from children\n  const [selectedItems, setSelectedItems] = React.useState<Array<string>>(mapValues(value));\n\n  // Fire onChange and set state\n  const setSelected = (selected: Array<string>) => {\n    setSelectedItems(selected);\n\n    if (onChange) {\n      const [first] = selected;\n      onChange(multiple ? selected : first);\n    }\n  };\n\n  React.useEffect(() => {\n    setSelectedItems(mapValues(value));\n  }, [value]);\n\n  const {\n    isOpen: open,\n    getToggleButtonProps,\n    getLabelProps,\n    getMenuProps,\n    highlightedIndex,\n    getItemProps,\n  } = useSelect<Item>({\n    items,\n    stateReducer,\n    selectedItem: null,\n    initialHighlightedIndex: items.findIndex(({ value: v }) => v.toString() === selectedItems[0]),\n    itemToString,\n    onSelectedItemChange: ({ selectedItem }) => {\n      if (!selectedItem) {\n        return;\n      }\n\n      const selectedValue = itemToString(selectedItem);\n\n      if (!multiple) {\n        setSelected([selectedValue]);\n        return;\n      }\n\n      const index = selectedItems.findIndex((v) => v === selectedValue);\n\n      if (index > 0) {\n        setSelected([...selectedItems.slice(0, index), ...selectedItems.slice(index + 1)]);\n      } else if (index === 0) {\n        setSelected([...selectedItems.slice(1)]);\n      } else {\n        setSelected([...selectedItems, selectedValue]);\n      }\n    },\n  });\n\n  const context = {\n    id,\n    open,\n    items,\n    selectedItems,\n    highlightedIndex,\n    getMenuProps,\n    getItemProps,\n    getToggleButtonProps,\n    itemToString,\n    multiple,\n    disabled,\n    invalid,\n    autofocus,\n    size,\n    text,\n    disableDefaultStyles,\n    customClassNames: {\n      buttonClassName,\n      dropdownClassName,\n      optionClassName,\n    },\n  };\n\n  // Render hidden inputs for form submissions if name is set\n  const renderInputs = isString(name) && !disabled;\n\n  return (\n    <SelectContextProvider value={context}>\n      <Box css={[styles.container, stylesProp]} ref={ref} className={className}>\n        {label && (\n          <Label visuallyHidden {...getLabelProps()}>\n            {label}\n          </Label>\n        )}\n\n        <Button />\n\n        <Dropdown />\n\n        {renderInputs &&\n          selectedItems.map((v) => <Box as=\"input\" type=\"hidden\" name={name} value={v} key={`${name}-${v}`} />)}\n      </Box>\n    </SelectContextProvider>\n  );\n});\n\nif (__DEV__) {\n  Select.displayName = 'Select';\n}\n\nexport default Select;\nexport { default as Option } from './components/Option';\nexport * from './components/Option';\nexport type { SelectProps };\n"],"names":["Select","React","props","ref","id","useId","children","label","name","value","onChange","size","disabled","invalid","multiple","autofocus","text","disableDefaultStyles","stylesProp","styles","className","buttonClassName","dropdownClassName","optionClassName","useSelectStyles","selectStyles","getStylesObject","stateReducer","state","actionAndChanges","changes","type","useSelect","stateChangeTypes","MenuKeyDownEnter","MenuKeyDownSpaceButton","ItemClick","isOpen","highlightedIndex","itemToString","item","toString","items","cleanChildren","reduce","out","optionProps","mapValues","input","values","isArray","map","String","slice","selectedItems","setSelectedItems","setSelected","selected","first","selectedItem","initialHighlightedIndex","findIndex","v","onSelectedItemChange","selectedValue","index","open","getToggleButtonProps","getLabelProps","getMenuProps","getItemProps","context","customClassNames","renderInputs","isString","_jsx","_jsxs","container","__DEV__","displayName"],"mappings":"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"}