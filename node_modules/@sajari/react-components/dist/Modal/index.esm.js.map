{"version":3,"file":"index.esm.js","sources":["../../src/Modal/index.tsx"],"sourcesContent":["import { __DEV__, getStylesObject, isSSR } from '@sajari/react-sdk-utils';\nimport classnames from 'classnames';\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport Box from '../Box';\nimport FocusLock from '../FocusLock';\nimport { AriaHidden } from './AriaHidden';\nimport ModalContextProvider from './context';\nimport ModalBody, { ModalBodyProps } from './ModalBody';\nimport ModalCloseButton, { ModalCloseButtonProps } from './ModalCloseButton';\nimport ModalFooter, { ModalFooterProps } from './ModalFooter';\nimport ModalHeader, { ModalHeaderProps } from './ModalHeader';\nimport { modalManager, useModalManager } from './modalManager';\nimport ModalTitle, { ModalTitleProps } from './ModalTitle';\nimport Portal from './Portal';\nimport { useModalStyles } from './styles';\nimport { ModalProps } from './types';\nimport { useScrollLock } from './useScrollLock';\n\nconst Modal = (props: ModalProps) => {\n  const {\n    open,\n    blockScroll = true,\n    closeOnEsc = true,\n    closeOnOverlayClick = true,\n    container,\n    role = 'dialog',\n    ariaDescribedby,\n    ariaLabelledby,\n    modalId,\n    onClose,\n    onEscKeyDown,\n    trapFocus = true,\n    autoFocus = true,\n    initialFocusRef,\n    finalFocusRef,\n    returnFocusOnClose = true,\n    onOverlayClick,\n    onAnimationEnd,\n    children,\n    disableDefaultStyles = false,\n    styles: stylesProp,\n    modalClassName,\n    modalContainerClassName,\n    overlayClassName,\n    overlayOpenClassName,\n    modalOpenClassName,\n    size = 'md',\n    rootClassName,\n    useInert = true,\n  } = props;\n  const refModal = useRef<HTMLDivElement>(null);\n  const refShouldClose = useRef<boolean | null>(null);\n  const refContainer = useRef<HTMLDivElement | null>(null);\n  const styles = getStylesObject(useModalStyles({ ...props, size }), disableDefaultStyles);\n\n  // Lazily create the ref instance\n  // https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\n  if (refContainer.current === null && !isSSR()) {\n    refContainer.current = document.createElement('div');\n  }\n\n  // The value should be false for srr, that way when the component is hydrated client side,\n  // it will match the server rendered content\n  const [showPortal, setShowPortal] = useState(false);\n\n  // Hook used to manage multiple modals opened at the same time\n  useModalManager(refModal, open);\n\n  // Hook used to manage the scroll\n  useScrollLock(refModal, open, showPortal, blockScroll);\n\n  const handleKeydown = (event: KeyboardEvent) => {\n    // Only the last modal need to be escaped when pressing the esc key\n    if (event.keyCode !== 27 || !modalManager.isTopModal(refModal)) {\n      return;\n    }\n\n    onEscKeyDown?.(event);\n\n    if (closeOnEsc) {\n      onClose();\n    }\n  };\n\n  const handleOpen = () => {\n    if (refContainer.current && !container && !document.body.contains(refContainer.current)) {\n      document.body.appendChild(refContainer.current);\n    }\n\n    document.addEventListener('keydown', handleKeydown);\n  };\n\n  const handleClose = () => {\n    if (refContainer.current && !container && document.body.contains(refContainer.current)) {\n      document.body.removeChild(refContainer.current);\n    }\n    document.removeEventListener('keydown', handleKeydown);\n  };\n\n  useEffect(() => {\n    return () => {\n      if (showPortal) {\n        // When the modal is closed or removed directly, cleanup the listeners\n        handleClose();\n      }\n    };\n  }, [showPortal]);\n\n  useEffect(() => {\n    // If the open prop is changing, we need to open the modal\n    // This is also called on the first render if the open prop is true when the modal is created\n    if (open && !showPortal) {\n      setShowPortal(true);\n      handleOpen();\n    }\n  }, [open]);\n\n  const handleClickOverlay = (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (refShouldClose.current === null) {\n      refShouldClose.current = true;\n    }\n\n    if (!refShouldClose.current) {\n      refShouldClose.current = null;\n      return;\n    }\n\n    onOverlayClick?.(event);\n\n    if (closeOnOverlayClick) {\n      onClose();\n    }\n\n    refShouldClose.current = null;\n  };\n\n  const handleModalEvent = () => {\n    refShouldClose.current = false;\n  };\n\n  const handleAnimationEnd = () => {\n    if (!open) {\n      setShowPortal(false);\n    }\n    onAnimationEnd?.();\n  };\n\n  const containerModal = container || refContainer.current;\n\n  const context = {\n    titleId: ariaLabelledby,\n    bodyId: ariaDescribedby,\n    disableDefaultStyles,\n    size,\n    onClose,\n    open,\n  };\n\n  return showPortal && containerModal ? (\n    <Portal target={containerModal}>\n      <ModalContextProvider value={context}>\n        <FocusLock\n          autoFocus={autoFocus}\n          disabled={!trapFocus}\n          contentRef={refModal}\n          initialFocusRef={initialFocusRef}\n          finalFocusRef={finalFocusRef}\n          restoreFocus={returnFocusOnClose}\n        >\n          <Box className={rootClassName} css={stylesProp}>\n            <Box\n              className={classnames(overlayClassName, open ? overlayOpenClassName : '')}\n              aria-hidden\n              css={styles.overlay}\n            >\n              <Box css={styles.overlayInner} />\n            </Box>\n            <Box\n              ref={refModal}\n              className={modalContainerClassName}\n              css={styles.container}\n              data-testid=\"modal-container\"\n              onAnimationEnd={handleAnimationEnd}\n              onClick={handleClickOverlay}\n            >\n              <Box\n                data-testid=\"modal\"\n                className={classnames(modalClassName, open ? modalOpenClassName : '')}\n                onMouseDown={handleModalEvent}\n                onMouseUp={handleModalEvent}\n                onClick={handleModalEvent}\n                id={modalId}\n                role={role}\n                aria-modal=\"true\"\n                aria-labelledby={ariaLabelledby}\n                aria-describedby={ariaDescribedby}\n                css={styles.content}\n              >\n                {children}\n              </Box>\n            </Box>\n          </Box>\n          <AriaHidden refModal={refModal} shouldHide={open && useInert} />\n        </FocusLock>\n      </ModalContextProvider>\n    </Portal>\n  ) : null;\n};\n\nif (__DEV__) {\n  Modal.displayName = 'Modal';\n}\n\nexport default Modal;\nexport { ModalBody, ModalCloseButton, ModalFooter, ModalHeader, ModalTitle };\nexport type { ModalBodyProps, ModalCloseButtonProps, ModalFooterProps, ModalHeaderProps, ModalProps, ModalTitleProps };\n"],"names":["Modal","props","open","blockScroll","closeOnEsc","closeOnOverlayClick","container","role","ariaDescribedby","ariaLabelledby","modalId","onClose","onEscKeyDown","trapFocus","autoFocus","initialFocusRef","finalFocusRef","returnFocusOnClose","onOverlayClick","onAnimationEnd","children","disableDefaultStyles","stylesProp","styles","modalClassName","modalContainerClassName","overlayClassName","overlayOpenClassName","modalOpenClassName","size","rootClassName","useInert","refModal","useRef","refShouldClose","refContainer","getStylesObject","useModalStyles","current","isSSR","document","createElement","useState","showPortal","setShowPortal","useModalManager","useScrollLock","handleKeydown","event","keyCode","modalManager","isTopModal","handleOpen","body","contains","appendChild","addEventListener","handleClose","removeChild","removeEventListener","useEffect","handleClickOverlay","handleModalEvent","handleAnimationEnd","containerModal","context","titleId","bodyId","_jsx","_jsxs","classnames","overlay","overlayInner","content","__DEV__","displayName"],"mappings":"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"}