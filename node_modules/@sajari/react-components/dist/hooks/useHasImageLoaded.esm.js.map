{"version":3,"file":"useHasImageLoaded.esm.js","sources":["../../src/hooks/useHasImageLoaded.ts"],"sourcesContent":["import { isSSR } from '@sajari/react-sdk-utils';\nimport { useEffect, useRef, useState } from 'react';\n\nimport { ImageProps } from '../Image/types';\n\n// TODO: Handle load failed fallback\n\ninterface HasImageLoadedProps {\n  src?: ImageProps['src'];\n  onLoad?: ImageProps['onLoad'];\n  onError?: ImageProps['onError'];\n}\n\nexport function useHasImageLoaded(props: HasImageLoadedProps) {\n  const { src, onLoad, onError } = props;\n  const ref = useRef(true);\n  const [hasLoaded, setHasLoaded] = useState(false);\n\n  useEffect(() => {\n    if (!src || isSSR()) {\n      return;\n    }\n\n    const image = new window.Image();\n\n    image.addEventListener('load', (event) => {\n      if (ref.current) {\n        setHasLoaded(true);\n\n        if (onLoad) {\n          onLoad.call(image, event);\n        }\n      }\n    });\n\n    image.addEventListener('error', (event) => {\n      if (ref.current) {\n        setHasLoaded(false);\n\n        if (onError) {\n          onError.call(image, event);\n        }\n      }\n    });\n\n    image.src = src;\n  }, [src, onLoad, onError]);\n\n  // eslint-disable-next-line arrow-body-style\n  useEffect(() => {\n    return () => {\n      ref.current = false;\n    };\n  }, []);\n\n  return hasLoaded;\n}\n"],"names":["useHasImageLoaded","props","src","onLoad","onError","ref","useRef","useState","hasLoaded","setHasLoaded","useEffect","isSSR","image","window","Image","addEventListener","event","current","call"],"mappings":";;;SAagBA,kBAAkBC;MACxBC,MAAyBD,MAAzBC;MAAKC,SAAoBF,MAApBE;MAAQC,UAAYH,MAAZG;AACrB,MAAMC,GAAG,GAAGC,MAAM,CAAC,IAAD,CAAlB;;kBACkCC,QAAQ,CAAC,KAAD;MAAnCC;MAAWC;;AAElBC,EAAAA,SAAS,CAAC;AACR,QAAI,CAACR,GAAD,IAAQS,KAAK,EAAjB,EAAqB;AACnB;AACD;;AAED,QAAMC,KAAK,GAAG,IAAIC,MAAM,CAACC,KAAX,EAAd;AAEAF,IAAAA,KAAK,CAACG,gBAAN,CAAuB,MAAvB,EAA+B,UAACC,KAAD;AAC7B,UAAIX,GAAG,CAACY,OAAR,EAAiB;AACfR,QAAAA,YAAY,CAAC,IAAD,CAAZ;;AAEA,YAAIN,MAAJ,EAAY;AACVA,UAAAA,MAAM,CAACe,IAAP,CAAYN,KAAZ,EAAmBI,KAAnB;AACD;AACF;AACF,KARD;AAUAJ,IAAAA,KAAK,CAACG,gBAAN,CAAuB,OAAvB,EAAgC,UAACC,KAAD;AAC9B,UAAIX,GAAG,CAACY,OAAR,EAAiB;AACfR,QAAAA,YAAY,CAAC,KAAD,CAAZ;;AAEA,YAAIL,OAAJ,EAAa;AACXA,UAAAA,OAAO,CAACc,IAAR,CAAaN,KAAb,EAAoBI,KAApB;AACD;AACF;AACF,KARD;AAUAJ,IAAAA,KAAK,CAACV,GAAN,GAAYA,GAAZ;AACD,GA5BQ,EA4BN,CAACA,GAAD,EAAMC,MAAN,EAAcC,OAAd,CA5BM,CAAT;AA+BAM,EAAAA,SAAS,CAAC;AACR,WAAO;AACLL,MAAAA,GAAG,CAACY,OAAJ,GAAc,KAAd;AACD,KAFD;AAGD,GAJQ,EAIN,EAJM,CAAT;AAMA,SAAOT,SAAP;AACD;;;;"}