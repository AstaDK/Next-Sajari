{"version":3,"file":"server.cjs.production.min.js","sources":["../src/search/index.tsx"],"sourcesContent":["import { combineFilters, EVENT_RESPONSE_UPDATED, Response, SearchProviderValues, Variables } from '@sajari/react-hooks';\nimport { isEmpty } from '@sajari/react-sdk-utils';\n\nfunction search(props: SearchProviderValues['search']): Promise<string | null> {\n  if (!props) {\n    throw new Error('search function requires a `search` config');\n  }\n\n  const { pipeline, filters, variables = new Variables() } = props;\n  const filter = combineFilters(filters ?? []);\n  const variablesFilterString = variables.get().filter ?? '';\n\n  variables.set({\n    filter: () => {\n      const expression = filter.filter();\n      return [variablesFilterString, isEmpty(expression) ? '_id != \"\"' : expression].filter(Boolean).join(' AND ');\n    },\n    countFilters: () => filter.countFilters(),\n    buckets: () => filter.buckets(),\n    count: () => filter.count(),\n  });\n\n  return new Promise((resolve) => {\n    const unlisten = pipeline.listen(EVENT_RESPONSE_UPDATED, (response: Response) => {\n      unlisten();\n\n      if (!response || response.isError()) {\n        resolve(null);\n        return;\n      }\n\n      const serialized = JSON.stringify({\n        queryValues: Object.fromEntries(response.getQueryValues() ?? []),\n        response: Object.fromEntries(response.getResponse() ?? []),\n        values: Object.fromEntries(response.getValues() ?? []),\n      });\n\n      resolve(serialized);\n    });\n\n    pipeline.search(variables.get());\n  });\n}\n\nexport default search;\n"],"names":["props","Error","pipeline","filters","variables","Variables","filter","combineFilters","variablesFilterString","get","set","expression","isEmpty","Boolean","join","countFilters","buckets","count","Promise","resolve","unlisten","listen","EVENT_RESPONSE_UPDATED","response","isError","serialized","JSON","stringify","queryValues","Object","fromEntries","getQueryValues","getResponse","values","getValues","search"],"mappings":"sGAGA,SAAgBA,aACTA,QACG,IAAIC,MAAM,kDAGVC,EAAmDF,EAAnDE,SAAUC,EAAyCH,EAAzCG,UAAyCH,EAAhCI,UAAAA,aAAY,IAAIC,cACrCC,EAASC,uBAAeJ,EAAAA,EAAW,IACnCK,WAAwBJ,EAAUK,MAAMH,UAAU,UAExDF,EAAUM,IAAI,CACZJ,OAAQ,eACAK,EAAaL,EAAOA,eACnB,CAACE,EAAuBI,UAAQD,GAAc,YAAcA,GAAYL,OAAOO,SAASC,KAAK,UAEtGC,aAAc,kBAAMT,EAAOS,gBAC3BC,QAAS,kBAAMV,EAAOU,WACtBC,MAAO,kBAAMX,EAAOW,WAGf,IAAIC,SAAQ,SAACC,OACZC,EAAWlB,EAASmB,OAAOC,0BAAwB,SAACC,gBACxDH,IAEKG,IAAYA,EAASC,eAKpBC,EAAaC,KAAKC,UAAU,CAChCC,YAAaC,OAAOC,qBAAYP,EAASQ,oBAAoB,IAC7DR,SAAUM,OAAOC,qBAAYP,EAASS,iBAAiB,IACvDC,OAAQJ,OAAOC,qBAAYP,EAASW,eAAe,MAGrDf,EAAQM,QAVNN,EAAQ,SAaZjB,EAASiC,OAAO/B,EAAUK"}