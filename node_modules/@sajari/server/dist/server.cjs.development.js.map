{"version":3,"file":"server.cjs.development.js","sources":["../src/search/index.tsx"],"sourcesContent":["import { combineFilters, EVENT_RESPONSE_UPDATED, Response, SearchProviderValues, Variables } from '@sajari/react-hooks';\nimport { isEmpty } from '@sajari/react-sdk-utils';\n\nfunction search(props: SearchProviderValues['search']): Promise<string | null> {\n  if (!props) {\n    throw new Error('search function requires a `search` config');\n  }\n\n  const { pipeline, filters, variables = new Variables() } = props;\n  const filter = combineFilters(filters ?? []);\n  const variablesFilterString = variables.get().filter ?? '';\n\n  variables.set({\n    filter: () => {\n      const expression = filter.filter();\n      return [variablesFilterString, isEmpty(expression) ? '_id != \"\"' : expression].filter(Boolean).join(' AND ');\n    },\n    countFilters: () => filter.countFilters(),\n    buckets: () => filter.buckets(),\n    count: () => filter.count(),\n  });\n\n  return new Promise((resolve) => {\n    const unlisten = pipeline.listen(EVENT_RESPONSE_UPDATED, (response: Response) => {\n      unlisten();\n\n      if (!response || response.isError()) {\n        resolve(null);\n        return;\n      }\n\n      const serialized = JSON.stringify({\n        queryValues: Object.fromEntries(response.getQueryValues() ?? []),\n        response: Object.fromEntries(response.getResponse() ?? []),\n        values: Object.fromEntries(response.getValues() ?? []),\n      });\n\n      resolve(serialized);\n    });\n\n    pipeline.search(variables.get());\n  });\n}\n\nexport default search;\n"],"names":["search","props","Error","pipeline","filters","variables","Variables","filter","combineFilters","variablesFilterString","get","set","expression","isEmpty","Boolean","join","countFilters","buckets","count","Promise","resolve","unlisten","listen","EVENT_RESPONSE_UPDATED","response","isError","serialized","JSON","stringify","queryValues","Object","fromEntries","getQueryValues","getResponse","values","getValues"],"mappings":";;;;;AAGA,SAASA,MAAT,CAAgBC,KAAhB;;;AACE,MAAI,CAACA,KAAL,EAAY;AACV,UAAM,IAAIC,KAAJ,CAAU,4CAAV,CAAN;AACD;;MAEOC,WAAmDF,MAAnDE;MAAUC,UAAyCH,MAAzCG;yBAAyCH,MAAhCI;MAAAA,0CAAY,IAAIC,oBAAJ;;AACvC,MAAMC,OAAM,GAAGC,yBAAc,CAACJ,OAAD,WAACA,OAAD,GAAY,EAAZ,CAA7B;;AACA,MAAMK,qBAAqB,4BAAGJ,SAAS,CAACK,GAAV,GAAgBH,MAAnB,oCAA6B,EAAxD;AAEAF,EAAAA,SAAS,CAACM,GAAV,CAAc;AACZJ,IAAAA,MAAM,EAAE;AACN,UAAMK,UAAU,GAAGL,OAAM,CAACA,MAAP,EAAnB;;AACA,aAAO,CAACE,qBAAD,EAAwBI,qBAAO,CAACD,UAAD,CAAP,GAAsB,WAAtB,GAAoCA,UAA5D,EAAwEL,MAAxE,CAA+EO,OAA/E,EAAwFC,IAAxF,CAA6F,OAA7F,CAAP;AACD,KAJW;AAKZC,IAAAA,YAAY,EAAE;AAAA,aAAMT,OAAM,CAACS,YAAP,EAAN;AAAA,KALF;AAMZC,IAAAA,OAAO,EAAE;AAAA,aAAMV,OAAM,CAACU,OAAP,EAAN;AAAA,KANG;AAOZC,IAAAA,KAAK,EAAE;AAAA,aAAMX,OAAM,CAACW,KAAP,EAAN;AAAA;AAPK,GAAd;AAUA,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD;AACjB,QAAMC,QAAQ,GAAGlB,QAAQ,CAACmB,MAAT,CAAgBC,iCAAhB,EAAwC,UAACC,QAAD;;;AACvDH,MAAAA,QAAQ;;AAER,UAAI,CAACG,QAAD,IAAaA,QAAQ,CAACC,OAAT,EAAjB,EAAqC;AACnCL,QAAAA,OAAO,CAAC,IAAD,CAAP;AACA;AACD;;AAED,UAAMM,UAAU,GAAGC,IAAI,CAACC,SAAL,CAAe;AAChCC,QAAAA,WAAW,EAAEC,MAAM,CAACC,WAAP,0BAAmBP,QAAQ,CAACQ,cAAT,EAAnB,oCAAgD,EAAhD,CADmB;AAEhCR,QAAAA,QAAQ,EAAEM,MAAM,CAACC,WAAP,0BAAmBP,QAAQ,CAACS,WAAT,EAAnB,oCAA6C,EAA7C,CAFsB;AAGhCC,QAAAA,MAAM,EAAEJ,MAAM,CAACC,WAAP,wBAAmBP,QAAQ,CAACW,SAAT,EAAnB,kCAA2C,EAA3C;AAHwB,OAAf,CAAnB;AAMAf,MAAAA,OAAO,CAACM,UAAD,CAAP;AACD,KAfgB,CAAjB;AAiBAvB,IAAAA,QAAQ,CAACH,MAAT,CAAgBK,SAAS,CAACK,GAAV,EAAhB;AACD,GAnBM,CAAP;AAoBD;;;;"}