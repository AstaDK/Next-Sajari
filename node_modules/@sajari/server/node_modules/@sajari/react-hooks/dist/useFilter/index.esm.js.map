{"version":3,"file":"index.esm.js","sources":["../../src/useFilter/index.ts"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\n\nimport { FilterBuilder, useContext } from '../ContextProvider';\nimport { EVENT_SELECTION_UPDATED } from '../ContextProvider/events';\nimport { getBucketCount } from '../utils';\nimport { FilterItem, SortType } from './types';\nimport { sortItems } from './utils';\n\nfunction useFilter(name: string, params: { sort?: SortType; sortAscending?: boolean } = {}) {\n  const {\n    search: { filters = [], response },\n  } = useContext();\n\n  const filter = useMemo(\n    () => filters.filter((f) => f instanceof FilterBuilder && f.getName() === name)[0] as FilterBuilder,\n    [],\n  );\n\n  if (!filter) {\n    throw new Error(`Filter \"${name}\" doesn't exist.`);\n  }\n\n  const [selected, setInternalSelected] = useState(filter.get());\n\n  useEffect(() => {\n    const removeListener = filter.listen(EVENT_SELECTION_UPDATED, () => {\n      setInternalSelected(filter.get());\n    });\n\n    return () => {\n      removeListener();\n    };\n  }, []);\n\n  const setSelected = (value: string[], merge = false) => {\n    filter.set(value, merge);\n  };\n\n  const reset = () => {\n    filter.reset();\n  };\n\n  const { sort = 'alpha', sortAscending = sort !== 'count' } = params;\n\n  const options: FilterItem[] = useMemo(() => {\n    if (!response || response?.isEmpty()) {\n      return [];\n    }\n\n    const aggregates = response.getAggregates();\n    const aggregateFilters = response.getAggregateFilters();\n    const isCount = filter.getCount();\n    const field = filter.getField();\n\n    if (isCount && field) {\n      const array = filter.isArray();\n      let count = {};\n      ({ count } = (aggregateFilters || {})[field] || {});\n      if (!count) {\n        ({ count = {} } = (aggregates || {})[field] || {});\n      }\n\n      const temp = sortItems(Object.entries(count), sort, sortAscending)\n        // eslint-disable-next-line @typescript-eslint/no-shadow\n        .map(([label, count]: [string, number]) => ({\n          label,\n          count,\n          value: array ? `${field} ~ [\"${label}\"]` : `${field} = \"${label}\"`,\n        }));\n\n      filter.setOptions(temp.reduce((a, c) => ({ ...a, [c.label]: c.value }), {}));\n\n      return temp;\n    }\n\n    return sortItems(Object.entries(filter.getOptions()), sort, sortAscending).map(([label, value]) => {\n      const id = `${name}_${label}`;\n      const count = getBucketCount(response, id);\n\n      return { label, value, count } as FilterItem;\n    });\n  }, [JSON.stringify(response?.getResults())]);\n\n  return {\n    options,\n    setSelected,\n    selected,\n    reset,\n    multi: filter.isMulti(),\n  };\n}\n\nexport default useFilter;\nexport * from './types';\n"],"names":["useFilter","name","params","useContext","search","filters","response","filter","useMemo","f","FilterBuilder","getName","Error","useState","get","selected","setInternalSelected","useEffect","removeListener","listen","EVENT_SELECTION_UPDATED","setSelected","value","merge","set","reset","sort","sortAscending","options","isEmpty","aggregates","getAggregates","aggregateFilters","getAggregateFilters","isCount","getCount","field","getField","array","isArray","count","temp","sortItems","Object","entries","map","label","setOptions","reduce","a","c","getOptions","id","getBucketCount","JSON","stringify","getResults","multi","isMulti"],"mappings":"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"}