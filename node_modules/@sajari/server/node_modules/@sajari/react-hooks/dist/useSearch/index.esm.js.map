{"version":3,"file":"index.esm.js","sources":["../../src/useSearch/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-shadow */\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { useContext } from '../ContextProvider';\nimport { defaultConfig } from '../ContextProvider/Config';\nimport { Response } from '../ContextProvider/controllers';\nimport { EVENT_RESPONSE_UPDATED, EVENT_VALUES_UPDATED } from '../ContextProvider/events';\nimport { UseSearchConfig, UseSearchCustomConfig, UseSearchParams, UseSearchResult } from './types';\n\nfunction useCustomSearch({ pipeline, variables }: UseSearchCustomConfig): UseSearchResult {\n  const [searching, setSearching] = useState(false);\n  const searchFn = useCallback(\n    (q?: string) => {\n      setSearching(true);\n\n      if (q === '') {\n        pipeline.clearResponse(variables.get());\n      } else {\n        if (q) {\n          variables.set({ [defaultConfig.qParam]: q });\n        }\n        pipeline.search(variables.get());\n      }\n    },\n    [pipeline, variables],\n  );\n\n  const [searchOutput, setSearchOutput] = useState<Omit<UseSearchResult, 'searching'>>({\n    search: searchFn,\n    error: null,\n  });\n\n  useEffect(() => {\n    searchFn();\n\n    return pipeline.listen(EVENT_RESPONSE_UPDATED, (response: Response) => {\n      setSearching(false);\n\n      setSearchOutput((o) => ({\n        ...o,\n        results: response?.getResults(),\n        latency: response?.getTime(),\n        totalResults: response?.getTotalResults(),\n        error: response?.getError(),\n      }));\n    });\n  }, []);\n\n  useEffect(\n    () =>\n      variables.listen(EVENT_VALUES_UPDATED, () => {\n        searchFn();\n      }),\n    [],\n  );\n\n  return { ...searchOutput, searching };\n}\n\nfunction useNormalSearch({ queryOverride, allowEmptySearch = true }: UseSearchConfig): UseSearchResult {\n  const [error, setError] = useState<Error | null>(null);\n  const {\n    search: { searching, response, search },\n    autocomplete: { search: searchInstantFn, suggestions },\n  } = useContext();\n\n  const results = response?.getResults();\n  const searchInstant = useCallback((q: string) => searchInstantFn(q), []);\n\n  useEffect(() => {\n    if (queryOverride !== undefined) {\n      if (allowEmptySearch || queryOverride !== '') {\n        search(queryOverride);\n      }\n    } else {\n      search();\n    }\n  }, [queryOverride]);\n\n  useEffect(() => {\n    if (response) {\n      switch (true) {\n        case response.isError():\n          setError(response.getError()?.error ?? new Error('Something went wrong. Please try again.'));\n          break;\n\n        case !response.isError():\n          setError(null);\n          break;\n\n        default:\n          break;\n      }\n    }\n  }, [response]);\n\n  return {\n    latency: response?.getTime(),\n    totalResults: response?.getTotalResults(),\n    suggestions: suggestions ?? [],\n    results,\n    search,\n    searchInstant,\n    searching,\n    error,\n  };\n}\n\nfunction useSearch(params?: UseSearchParams) {\n  if (typeof params === 'object' && 'pipeline' in params && 'variables' in params) {\n    return useCustomSearch(params);\n  }\n\n  return useNormalSearch(params ?? {});\n}\n\nexport default useSearch;\nexport * from './types';\n"],"names":["useCustomSearch","pipeline","variables","useState","searching","setSearching","searchFn","useCallback","q","clearResponse","get","set","defaultConfig","qParam","search","error","searchOutput","setSearchOutput","useEffect","listen","EVENT_RESPONSE_UPDATED","response","o","results","getResults","latency","getTime","totalResults","getTotalResults","getError","EVENT_VALUES_UPDATED","useNormalSearch","queryOverride","allowEmptySearch","setError","useContext","autocomplete","searchInstantFn","suggestions","searchInstant","undefined","isError","Error","useSearch","params"],"mappings":"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"}